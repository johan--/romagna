(function(){Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),String.prototype.convertToRGBA=function(){var a,b,c,d,e;switch(d=this.replace("#",""),d.length){case 3:a=1,e=2^parseInt(d.substring(0,1),16),c=2^parseInt(d.substring(1,2),16),b=2^parseInt(d.substring(2,3),16);break;case 4:a=parseInt(d.substring(0,1),16)^2/256,e=2^parseInt(d.substring(1,2),16),c=2^parseInt(d.substring(2,3),16),b=2^parseInt(d.substring(3,4),16);break;case 8:a=parseInt(d.substring(0,2),16)/256,e=parseInt(d.substring(2,4),16),c=parseInt(d.substring(4,6),16),b=parseInt(d.substring(6,8),16);break;case 6:a=1,e=parseInt(d.substring(0,2),16),c=parseInt(d.substring(2,4),16),b=parseInt(d.substring(4,6),16)}return"rgba("+e+", "+c+", "+b+", "+a+")"}}).call(this),function(){this.App=Ember.Application.create(),Ember.Application.initializer({name:"test",initialize:function(a){return console.log("initialized app"),a.lookup("store:main").reopen({findByIdOrCreate:function(a,b,c){var d;return null!=(d=this.getById(a,b))?d:this.createRecord(a,c)}})}}),App.ApplicationStore=DS.Store.extend({adapter:"DS.FixtureAdapter"}),App.getStore=function(){return this.__container__.lookup("store:main")}}.call(this),function(){App.TJ04SchemaParser=Ember.Object.extend({extractAllObjects:function(a){return a.context.object},extractAllAttributes:function(a){return a.context.attribute}}),App.TJ10SchemaParser={extractAllAttributes:function(a){var b;return b=[],_.each(a.diagrams,function(a){return _.each(a.node,function(a){var c;return c=_.map(a.attributeContingent.attribute,function(a){return a["#text"]}),b=_.union(b,c)})}),b},extractObjects:function(a){return _.compact(_.map(a.concept.objectContingent.object,function(a){return a["#text"]}))},extractAllObjects:function(a){var b,c=this;return b=[],_.each(a.diagrams,function(a){return _.each(a.node,function(a){var d;return d=c.extractObjects(a),b=_.union(b,d)})}),b},parseLabelInfo:function(a){var b,c,d,e,f,g,h,i,j,k,l;return null==a&&(a={}),b={offset:{x:parseFloat(null!=(c=null!=(d=a.offset)?d.x:void 0)?c:0,10),y:parseFloat(null!=(e=null!=(f=a.offset)?f.y:void 0)?e:0,10)},bgColor:null!=(g=null!=(h=a.backgroundColor)?h["#text"].convertToRGBA():void 0)?g:"#fff",textColor:null!=(i=null!=(j=a.textColor)?j["#text"].convertToRGBA():void 0)?i:"#000",textAlignment:null!=(k=null!=(l=a.textAlignment)?l["#text"]:void 0)?k:"middle"}},extractVisualInfo:function(a){var b;return b={position:{x:parseFloat(a.position.x,10),y:parseFloat(a.position.y,10)},objectLabel:this.parseLabelInfo(a.objectLabelStyle),attributeLabel:this.parseLabelInfo(a.attributeLabelStyle)}},createAttributeOrObject:function(a,b,c){var d,e;return d=c.all(a),e=d.findBy("value",b),e?e:c.createRecord(a,{id:_.uniqueId(a),value:b})},extractDiagram:function(a,b){var c,d,e,f=this;return d=this.store.findByIdOrCreate("diagram",b,{id:_.uniqueId("dia"),title:a._title}),d.get("parsed")||(d.set("parsed",!0),c=_.map(a.node,function(a){var b,c,d,e,g,h,i;return e=f.store.createRecord("concept_node",{id:_.uniqueId("node"),inDiagramId:a._id,position:{x:parseFloat(a.position._x,10),y:parseFloat(a.position._y,10)}}),Ember.isArray(a.concept.attributeContingent.attribute)?d=_.map(a.concept.attributeContingent.attribute,function(a){var b;return b=f.createAttributeOrObject("attribute",a,f.store)}):(d=[],_.isObject(a.concept.attributeContingent)&&(b=f.createAttributeOrObject("attribute",a.concept.attributeContingent.attribute,f.store),d.push(b))),e.get("attributes").pushObjects(d),Ember.isArray(a.concept.objectContingent.object)?i=_.map(a.concept.objectContingent.object,function(a){return f.createAttributeOrObject("object",a,f.store)}):(i=[],_.isObject(a.concept.objectContingent)&&(g=f.createAttributeOrObject("object",a.concept.objectContingent.object,f.store),i.push(g))),e.get("objects").pushObjects(i),a.attributeLabelStyle&&(c=f.store.createRecord("label_info",{id:_.uniqueId("label"),offset:{x:parseInt(a.attributeLabelStyle.offset._x,10),y:parseInt(a.attributeLabelStyle.offset._y,10)},bgColor:a.attributeLabelStyle.backgroundColor.convertToRGBA(),textColor:a.attributeLabelStyle.textColor.convertToRGBA(),textAlignment:a.attributeLabelStyle.textAlignment}),e.set("attributeLabel",c)),a.objectLabelStyle&&(h=f.store.createRecord("label_info",{id:_.uniqueId("label"),offset:{x:parseInt(a.objectLabelStyle.offset._x,10),y:parseInt(a.objectLabelStyle.offset._y,10)},bgColor:a.objectLabelStyle.backgroundColor.convertToRGBA(),textColor:a.objectLabelStyle.textColor.convertToRGBA(),textAlignment:a.objectLabelStyle.textAlignment}),e.set("objectLabel",h)),e}),d.get("concepts").pushObjects(c),e=_.map(a.edge,function(a){var b,c,e;return b=f.store.createRecord("edge",{id:_.uniqueId("edge")}),c=d.get("concepts").findBy("inDiagramId",a._to),e=d.get("concepts").findBy("inDiagramId",a._from),b.set("to",c),b.set("from",e),b.set("diagram",d),c.get("inboundEdges").pushObject(b),e.get("outboundEdges").pushObject(b),b}),d.get("edges").pushObjects(e)),d},extractDiagrams:function(a){return _.map(a.diagram,this.extractDiagram)},extractDiagramNames:function(a){var b,c=this;return this.store.unloadAll("diagram"),b=_.map(a.diagram,function(a){return c.store.createRecord("diagram",{id:_.uniqueId("dia"),title:a._title})})}},App.ContextParser=Ember.Object.extend({parsers:{"TJ0.4":App.TJ04SchemaParser,"TJ1.0":App.TJ10SchemaParser},parse:function(a,b,c,d,e){var f,g;return null==e&&(e=!0),this.parser=this.parsers[b],g=c.createRecord("conceptual_schema",{name:d,version:b}),this.parser.store=c,f=e?this.parser.extractDiagramNames(a,d):this.parser.extractDiagrams(a,d),console.log("finished parsing"),g.get("diagrams").pushObjects(f),g},parseSingleDiagram:function(a,b,c){return console.log(a,b,a.diagram.findBy("_title",b)),this.parser.extractDiagram(a.diagram.findBy("_title",b),c)}})}.call(this),function(){App.DimensionTransform=DS.Transform.extend({serialize:function(a){return{x:a.x,y:a.y}},deserialize:function(a){return Ember.create({x:a.x,y:a.y})}})}.call(this),function(){App.Attribute=DS.Model.extend({value:DS.attr("string"),concepts:DS.hasMany("concept_node")})}.call(this),function(){App.ConceptualSchema=DS.Model.extend({name:DS.attr("string"),version:DS.attr("string"),diagrams:DS.hasMany("diagrams"),context:DS.belongsTo("context"),concepts:DS.hasMany("concept_node")})}.call(this),function(){App.Diagram=DS.Model.extend({title:DS.attr("string"),fontSize:DS.attr("number",{defaultValue:10}),lineHeight:DS.attr("number",{defaultValue:11}),maxLabelHeight:DS.attr("number",{defaultValue:70}),fontInPX:function(){return""+this.get("fontSize")+"px"}.property("fontSize"),positionsX:Ember.computed.mapBy("concepts","position.x"),positionsY:Ember.computed.mapBy("concepts","position.y"),minX:Ember.computed.min("positionsX"),minY:Ember.computed.min("positionsY"),maxX:Ember.computed.max("positionsX"),maxY:Ember.computed.max("positionsY"),extentX:Ember.computed.collect("minX","maxX"),extentY:Ember.computed.collect("minY","maxY"),concepts:DS.hasMany("concept_node"),edges:DS.hasMany("edge")})}.call(this),function(){App.LabelInfo=DS.Model.extend({offset:DS.attr("dimension"),bgColor:DS.attr("string"),textColor:DS.attr("string"),textAlignment:DS.attr("string"),concept:DS.belongsTo("concept_node")})}.call(this),function(){App.Object=DS.Model.extend({value:DS.attr("string"),concepts:DS.hasMany("concept_node")})}.call(this),function(){App.Edge=DS.Model.extend({to:DS.belongsTo("concept_node",{inverse:"inboundEdges"}),from:DS.belongsTo("concept_node",{inverse:"outboundEdges"})})}.call(this),function(){App.ConceptNode=DS.Model.extend({inDiagramId:DS.attr("string"),position:DS.attr("dimension"),objects:DS.hasMany("object"),attributes:DS.hasMany("attribute"),objectLabel:DS.belongsTo("label_info"),attributeLabel:DS.belongsTo("label_info"),inboundEdges:DS.hasMany("edge",{inverse:"to"}),outboundEdges:DS.hasMany("edge",{inverse:"from"}),allEdges:Ember.computed.union("inboundEdges","outboundEdges"),connectedNodes:Ember.computed.union("filteredNodes","idealNodes"),idealNodes:function(){var a,b,c,d;for(d=[],a=this.get("inboundEdges").map(function(a){return a.get("from")});a.get("length");)d.pushObjects(a),b=_.flatten(a.map(function(a){return a.get("inboundEdges.content")})),c=b.mapBy("from"),a=c;return d}.property("inboundEdges"),filteredNodes:function(){var a,b,c,d;for(c=[],d=this.get("outboundEdges").map(function(a){return a.get("to")});d.get("length");)c.pushObjects(d),a=_.flatten(d.map(function(a){return a.get("outboundEdges.content")})),b=a.mapBy("to"),d=b;return c}.property("outboundEdges"),allObjects:function(){return this.get("filteredNodes").reduce(function(a,b){return a.pushObjects(b.get("objects.content")),a.uniq()},this.get("objects.content").copy())}.property("filteredNodes"),allAttributes:function(){return this.get("idealNodes").reduce(function(a,b){return a.pushObjects(b.get("attributes.content")),a.uniq()},this.get("attributes.content").copy())}.property("idealNodes"),intersectedObjects:function(a,b){return null==b&&(b="objects"),null!==a?Ember.EnumerableUtils.intersection(a,this.get(b)):this.get(b)}})}.call(this),function(){App.Context=DS.Model.extend({objects:DS.hasMany("object"),attributes:DS.hasMany("attribute"),schema:DS.belongsTo("conceptual_schema")})}.call(this),function(){App.ApplicationController=Ember.Controller.extend({csx:null,csxFileName:null,domParser:new DOMParser,xmlParser:new X2JS,contextParser:App.ContextParser.create(),parsedCSX:null,diagrams:[],schemaName:function(){return this.get("csxFileName").split(".")[0]||""}.property("csxFileName"),csxObserver:function(){var a,b;return console.log("changed csx file",this.get("csxFileName")),a=this.get("domParser").parseFromString(this.get("csx"),"text/xml"),b=this.get("xmlParser").xml2json(a),this.send("parseCSX",b)}.observes("csx"),actions:{parseCSX:function(a){var b,c;return c=a.conceptualSchema._version,this.set("csxJSON",a),b=a.conceptualSchema,this.set("conceptualSchema",this.get("contextParser").parse(b,c,this.store,this.get("schemaName"))),this.set("diagrams",this.get("conceptualSchema.diagrams"))}}})}.call(this),function(){App.SidebarController=Ember.Controller.extend({needs:["application","diagram"],needsSQL:!1,csx:Ember.computed.alias("controllers.application.csx"),csxFileName:Ember.computed.alias("controllers.application.csxFileName"),diagramList:Ember.computed.alias("controllers.application.diagrams"),objectLabelDisplay:Ember.computed.alias("controllers.diagram.objectLabelDisplay"),currentDiagram:null,pastConcepts:[],diagramQueue:[],queueIndex:-1,currentQueuedDiagram:null,objectLabelDisplayOptions:[{label:"Display count",value:"count"},{label:"Display list",value:"list"}],diagramQueueObserver:function(){return console.log("changed first object of the diagram queue",this.get("diagramQueue.firstObject")),this.set("currentQueuedDiagram",this.get("diagramQueue.firstObject")),this.set("queueIndex",0)}.observes("diagramQueue.firstObject"),currentQueuedDiagramObserver:function(){return console.log("changed current diagram",this.get("currentQueuedDiagram.title")),this.transitionToRoute("diagram",this.get("currentQueuedDiagram"))}.observes("currentQueuedDiagram"),actions:{parseCSX:function(a,b){return console.log("pretty neat actually ^_^",b),this.setProperties({diagramQueue:[],queueIndex:-1,currentQueuedDiagram:null}),this.set("csxFileName",b),this.set("csx",a)},addToQueue:function(a){return this.get("diagramQueue").pushObject(a)},advanceInQueue:function(){return this.set("currentQueuedDiagram",this.get("diagramQueue").nextObject(this.get("queueIndex"),this.get("currentQueuedDiagram"))),this.incrementProperty("queueIndex")}}})}.call(this),function(){App.DiagramController=Ember.ObjectController.extend({needs:["application","sidebar"],parser:Ember.computed.alias("controllers.application.contextParser"),pastConcepts:Ember.computed.alias("controllers.sidebar.pastConcepts"),diagramQueue:Ember.computed.alias("controllers.sidebar.diagramQueue"),queueIndex:Ember.computed.alias("controllers.sidebar.queueIndex"),objectLabelDisplay:"count",extractDiagram:function(){return this.get("parser").parseSingleDiagram(this.get("controllers.application.csxJSON.conceptualSchema"),this.get("model.title"))},objectFilter:function(){return Ember.isEmpty(this.get("pastConcepts"))?null:this.get("pastConcepts").reduce(function(a,b){return Ember.EnumerableUtils.intersection(a,b.get("objects"))},this.get("pastConcepts.firstObject.objects"))}.property("pastConcepts.@each"),actions:{filterByConcept:function(a){return this.get("pastConcepts").pushObject(a),this.get("controllers.sidebar").send("advanceInQueue")},focusConcept:function(a){return this.set("controllers.sidebar.focusedConcept",a)}}})}.call(this),function(){App.ApplicationRoute=Ember.Route.extend({renderTemplate:function(){return this.render(),this.render("sidebar",{outlet:"sidebar",into:"application"})},setupController:function(){}})}.call(this),function(){App.DiagramRoute=Ember.Route.extend({afterModel:function(a){return null===a?this.transitionToRoute("application"):void 0},setupController:function(a,b){return this.controllerFor("application").get("contextParser").parseSingleDiagram(this.controllerFor("application").get("csxJSON.conceptualSchema"),b.get("title"),b.get("id")),a.set("model",b)},actions:{error:function(){return this.transitionTo("application")},willTransition:function(a){var b,c;return b=this.controllerFor("diagram"),console.log(a.params.diagram.diagram_id,b.get("diagramQueue"),b.get("queueIndex"),b.get("diagramQueue")[b.get("queueIndex")-2].get("id")),b.get("queueIndex")>=2&&(null!=(c=a.params.diagram)?c.diagram_id:void 0)===b.get("diagramQueue")[b.get("queueIndex")-2].get("id")?b.get("pastConcepts").popObject():void 0}}})}.call(this),function(){App.SchemaRoute=Ember.Route.extend({setupController:function(){}})}.call(this),function(){App.ApplicationView=Ember.View.extend({elementId:"application-view",classNames:["application"]})}.call(this),function(){App.DiagramOptionView=Ember.SelectOption.extend({doubleClick:function(){var a,b;return this._super(),b=this.$().val(),a=this.get("parentView.content").findBy("id",b),this.get("controller").send("addToQueue",a)}})}.call(this),function(){App.DiagramView=Ember.View.extend({tagName:"svg",elementId:"default-diagram",model:Ember.computed.alias("controller.model"),objectFilter:Ember.computed.alias("controller.objectFilter"),attributeBindings:["preserveAspectRatio","width","height"],preserveAspectRatio:"xMidYMid meet",insertedElement:!1,defaultViewBox:"0 0 300 300",objectLabelDisplay:Ember.computed.alias("controller.objectLabelDisplay"),objectLabelDisplayObserver:function(){return Ember.run.next(this,this.draw)}.observes("objectLabelDisplay"),minX:Ember.computed.alias("model.minX"),minY:Ember.computed.alias("model.minY"),maxY:Ember.computed.alias("model.maxY"),maxX:Ember.computed.alias("model.maxX"),selectedNode:null,selectedNodes:function(){var a,b;return a=null!=(b=this.get("selectedNode.connectedNodes"))?b:[],Ember.isEmpty(a)||a.pushObject(this.get("selectedNode")),a}.property("selectedNode"),selectedEdges:function(){var a,b;return null!=(a=null!=(b=this.get("selectedNodes"))?b.map(function(a){return a.get("allEdges.content")}):void 0)?a:[]}.property("selectedNodes"),margin:50,boundingBox:function(){var a;return(null!=(a=this.get("element"))?a.getBBox():void 0)||{width:0,height:0}}.property("insertedElement","model.id"),viewBox:function(){var a,b,c,d;return this.get("insertedElement")?(c=this.get("minX")-this.get("margin"),d=this.get("minY")-this.get("margin"),b=this.get("boundingBox.height")+this.get("margin"),a=this.get("boundingBox.width"),""+c+" "+d+" "+a+" "+b):this.get("defaultViewBox")}.property("minX","minY","boundingBox","insertedElement"),width:function(){return this.get("insertedElement")?this.$().parent().width():void 0}.property("element","insertedElement"),height:function(){return this.get("insertedElement")?this.$().parent().height():void 0}.property("element","insertedElement"),viewBoxObserver:function(){}.observes("viewBox","insertedElement"),_updateDimensions:function(){var a;return a=this.$(),a.removeAttr("viewBox"),a.removeAttr("viewbox"),a.attr("width",this.get("width")),a.attr("height",this.get("height")),d3.select(this.get("element")).attr("viewBox",this.get("viewBox")),d3.select(this.get("element")).selectAll("rect.overlay").attr("width",this.get("width")).attr("height",this.get("height")).attr("transform","translate("+(this.get("minX")-50)+", "+(this.get("minY")-50)+")")},didInsertElement:function(){return this._super(),this._updateDimensions(),$(window).on("resize",Ember.run.bind(this,this._updateDimensions)),Ember.run.once(this,this.get("draw")),this.set("insertedElement",!0),Ember.run.next(this,this.get("_updateDimensions")),Ember.run.next(this,this.get("_insertOverlay"))},willDestroyElement:function(){return $(window).off("resize",Ember.run.bind(this,this._updateDimensions))},modelObserver:function(){return d3.select(this.get("element")).attr("viewBox",this.get("defaultViewBox")),Ember.run.once(this,this.get("draw")),Ember.run.next(this,this.get("_updateDimensions"))}.observes("model.id"),drawEdges:function(a,b){var c,d;return c=a.get("edges.content"),d=b.selectAll("line").data(c,function(a){return a.get("id")}),d.exit().remove(),d.enter().append("line").style("stroke","black").style("stroke-width",2).attr("x1",function(a){return a.get("from.position.x")}).attr("x2",function(a){return a.get("to.position.x")}).attr("y1",function(a){return a.get("from.position.y")}).attr("y2",function(a){return a.get("to.position.y")}),d},drawConcepts:function(a,b,c){var d,e,f,g;return e=a.get("concepts.content"),g=this,f=b.selectAll("g.concept").data(e,function(a){return a.get("id")}),f.exit().remove(),f.enter().append("g").attr("class","concept").attr("id",function(a){return"node-"+a.get("inDiagramId")}),d=f.append("circle"),d.style("fill","steelblue").attr("stroke","#000").attr("cy",function(a){return a.get("position.y")}).attr("cx",function(a){return a.get("position.x")}).attr("r",function(a){return a.intersectedObjects(g.get("objectFilter")).get("length")?10:3}),d.on("click",function(a){var b,e,f,h;return h=d3.select(this),Ember.isEqual(g.get("selectedNode"),a)?g.set("selectedNode",null):g.set("selectedNode",a),b=g.get("selectedEdges"),e=c.filter(function(a){return g.get("selectedEdges").contains(a)}),f=d.filter(function(a){return g.get("selectedNodes").contains(a)}),c.transition().style("stroke-width",function(a){return g.get("selectedEdges").contains(a)?5:2}),d.transition().style("fill",function(a){return g.get("selectedNodes").contains(a)?"red":"steelblue"}).style("stroke-width",function(a){return g.get("selectedNodes").contains(a)?3:1})}),d.on("dblclick",function(a){var b,c;return d3.event.preventDefault(),"function"==typeof(b=d3.event).stopImmediatePropagation&&b.stopImmediatePropagation(),"function"==typeof(c=d3.event).stopPropagation&&c.stopPropagation(),g.get("controller").send("filterByConcept",a)}),d.on("mouseover",function(a){return g.get("controller").send("focusConcept",a)}),f},drawLabels:function(a,b,c){var d;return d=this,c.each(function(b){var c,e,f,g,h,i,j,k,l,m,n;if(f=d3.select(this),Ember.isEmpty(b.get("attributes"))||(c=f.append("g").attr("class","concept-attribute-label"),c.append("rect").attr("height",function(b){return a.get("lineHeight")*b.get("attributes.length")}).attr("fill",function(a){return a.get("attributeLabel.bgColor")}).attr("stroke","#000"),n=[],c.append("text").attr("fill",b.get("attributeLabel.textColor")).each(function(b){var c,d=this;return c=b.get("attributes.content"),b.get("attributes").forEach(function(b,c){return d3.select(d).append("tspan").text(function(){return b.get("value")}).attr("text-anchor","left").attr("x",3).attr("dy",c?a.get("lineHeight"):0).attr("text-anchor",function(){return n.push(this.getComputedTextLength())})})}).attr("text-anchor","left").attr("x",function(){return 3}).attr("y",a.get("lineHeight")-1),c.select("rect").attr("width",function(a){var b;return b=d3.max(n),a.set("textLength",b),b+10}),c.attr("transform",function(b){var c,d;return c=b.get("position.x")+b.get("attributeLabel.offset.x")-b.get("textLength")+10,d=b.get("position.y")+b.get("attributeLabel.offset.y")-a.get("fontSize")-a.get("lineHeight"),"translate("+c+", "+d+")"})),!Ember.isEmpty(b.get("objects"))){if(f.selectAll("g.concept-object-label").remove(),i=f.append("g").attr("class","concept-object-label").attr("transform",function(b){var c,d;return c=b.get("position.x")+b.get("objectLabel.offset.x")-10,d=b.get("position.y")+b.get("objectLabel.offset.y")+a.get("fontSize")+3,"translate("+c+", "+d+")"}),j=i.append("rect").attr("width",20).attr("fill",function(a){return a.get("objectLabel.bgColor")}).attr("stroke","#000"),k=i.append("text").attr("fill",function(a){return a.get("objectLabel.textColor")}),"count"===d.get("objectLabelDisplay"))return k.selectAll("tspan").remove(),k.text(function(a){return a.intersectedObjects(d.get("objectFilter")).get("length")}).attr("text-anchor","middle").attr("x",10).attr("y",function(){return a.get("lineHeight")-2}),j.attr("height",a.get("lineHeight"));if("list"===d.get("objectLabelDisplay"))return m=b.intersectedObjects(d.get("objectFilter")),l=m.get("length"),g=i.append("foreignObject"),e=g.append("xhtml:body"),h=e.append("ul").selectAll("li").data(m.get("content")),h.enter().append("li").text(function(a){return a.get("value")}),g.attr("height",d3.min([l*a.get("lineHeight"),a.get("maxLabelHeight")])),e.attr("height",d3.min([l*a.get("lineHeight"),a.get("maxLabelHeight")])),g.attr("width",200)}})},draw:function(){var a,b,c,d,e,f,g;return b=this.get("model"),f=d3.select(this.get("element")),g=d3.behavior.zoom().scaleExtent([1,6]).on("zoom",Ember.run.bind(this,this._zoom)),c=f.selectAll("g.diagram").data([b],function(a){return a.get("id")}),c.exit().remove(),c.enter().append("g").attr("class","diagram"),e=c.append("rect"),e.classed({overlay:!0}),d=this.drawEdges(b,c),a=this.drawConcepts(b,c,d),this.drawLabels(b,c,a)},_zoom:function(){return d3.select(this.get("element")).select("g.diagram").attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")},_insertOverlay:function(){}})}.call(this),function(){App.FileUploadComponent=Ember.TextField.extend({type:"file",attributeBindings:"name",change:function(a){var b,c,d=this;return console.log("Changed file"),b=a.target,b.files&&b.files[0]?(c=new FileReader,c.onload=function(a){var c;return console.log("We read the file!",b.files[0].name),c=a.target.result,d.sendAction("action",c,b.files[0].name)},c.readAsText(b.files[0])):void 0}})}.call(this),function(){App.RadioButton=Ember.Component.extend({tagName:"input",type:"radio",attributeBindings:["name","type","value","checked:checked"],click:function(){return this.set("selection",this.$().val())},checked:function(){return this.get("value")===this.get("selection")}.property("selection")}),App.LabelRadioComponent=Ember.Component.extend({name:"radio"}),Ember.Handlebars.helper("radio-button",App.RadioButton)}.call(this),function(){App.Router.map(function(){return this.resource("diagram",{path:"/:diagram_id"})})}.call(this),function(){var a,b;b=null,this.loadContext=function(c){var d,e,f,g;return b=xml2json(c),g=b.conceptualSchema.props.version,d=new ContextParser,App.schema=d.createSchema(b.conceptualSchema,g),e=d3.selectAll("#diagrams").selectAll("option").data(App.schema.diagrams,function(a){return a.get("title")}),e.enter().append("option").attr("value",function(a,b){return b}).text(function(a){return a.title}),e.exit().remove(),f=d3.dispatch("load","change"),f.on("load",function(){return a(0)}),f.on("change",a),f.load(0),d3.selectAll("#diagrams").on("change",function(){return f.change()}),b},$(document).ready(function(){}),a=function(a){var b,c,d,e,f,g,h;return null==a&&(a=d3.event.target.value),d=app.schema.diagrams[+a],h=d3.select("svg#default-diagram"),e=h.selectAll("g.diagram").data([d],function(a){return a.title}),e.exit().remove(),e.enter().append("g").attr("class","diagram"),f=e.selectAll("line").data(d.edges,function(a){return""+d.title+"-"+a.from+"-"+a.to}),f.exit().remove(),f.enter().append("line").style("stroke",function(){return d.title?"black":"#333"}).style("stroke-width",2).attr("x1",function(a){var b,c;return b=a.from-1,c=d.concepts[b].visual.position.x}).attr("x2",function(a){var b,c;return c=a.to-1,b=d.concepts[c].visual.position.x}).attr("y1",function(a){var b,c;return b=a.from-1,c=d.concepts[b].visual.position.y}).attr("y2",function(a){var b,c;return c=a.to-1,b=d.concepts[c].visual.position.y}),c=e.selectAll("g.concept").data(d.concepts,function(a){return d.title+a.id}),g=d3.scale.linear().domain([0,d3.max(d.concepts,function(a){var b;return(null!=(b=a.objects.objectRef)?b.length:void 0)||0})]).range([15,30]),c.exit().remove(),c.enter().append("g").attr("class","concept"),b=c.append("circle"),b.style("fill",function(){return"Status"===d.title?"steelblue":"red"}).attr("stroke","#000").attr("cy",function(a){return a.visual.position.y}).attr("cx",function(a){return a.visual.position.x}).attr("r",function(a){return a.hasObjects()?10:3}),b.on("click",function(a){var b,c;return console.log("clicked a circle",a.id),a.selected=!a.selected,c=d3.select(this),b=f.filter(function(b){return b.from===a.id||b.to===a.id}),console.log(b),b.transition().style("stroke-width",function(){return a.selected?4:2}),d3.select(this).transition().style("fill",function(a){return a.selected?"blue":"red"}).style("stroke-width",function(a){return a.selected?2:1})}),c.each(function(a){var b,c,e;return c=d3.select(this),a.hasAttributes()&&(b=c.append("g").attr("class","concept-attribute-label").attr("transform",function(a){var b,c;return b=a.visual.position.x+a.visual.attributeLabel.offset.x-50,c=a.visual.position.y+a.visual.attributeLabel.offset.y-d.options.fontSize-d.options.lineHeight,"translate("+b+", "+c+")"}),b.append("rect").attr("height",function(a){var b,c;return b=a.attributes.attributeRef||a.attributes.attribute,c=Array.isArray(b)?b.length:1,15*c}).attr("fill",function(a){return a.visual.attributeLabel.bgColor}).attr("stroke","#000"),b.append("text").attr("fill","#000").each(function(a){var b,c,e,f,g;if(b=a.getAttributes(),Array.isArray(b)){f=_.pluck(b,"name"),g=[];for(e in f)c=f[e],d3.select(this).append("tspan").attr("dx",0).attr("dy",e*d.options.fontSize).text(function(){return c}),g.push(a.textLength=this.getComputedTextLength());return g}return d3.select(this).text(b.name),a.textLength=this.getComputedTextLength()}).attr("text-anchor","middle").attr("x",function(){return d3.max([this.getComputedTextLength()/2,50])}).attr("y",12),b.select("rect").attr("width",function(a){return d3.max([a.textLength+10,100])})),a.hasObjects()?(e=c.append("g").attr("class","concept-object-label").attr("transform",function(a){var b,c;return b=parseInt(a.visual.position.x)+a.visual.objectLabel.offset.x-10,c=parseInt(a.visual.position.y)+a.visual.objectLabel.offset.y+d.options.fontSize+3,"translate("+b+", "+c+")"}),e.append("rect").attr("width",20).attr("height",15).attr("fill",function(a){return a.visual.objectLabel.bgColor}).attr("stroke","#000"),e.append("text").attr("fill",function(a){return a.visual.objectLabel.textColor}).text(function(a){return a.objectCount()||0}).attr("text-anchor","middle").attr("x",10).attr("y",12)):void 0}),$("svg").attr("width",$("svg").parent().width()),$("svg").attr("height",$("svg").parent().height()),h.attr("viewBox",function(){var a,b,c,e;return a=this.getBBox(),e=d.extent.y[0]-50,c=d.extent.x[0]-50,window.positions=_.map(d.concepts,function(a){return a.visual.position}),b=a.height+50,""+c+" "+e+" "+a.width+" "+b})}}.call(this);